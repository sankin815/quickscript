{"version":3,"file":"extension.js","mappings":"28BA0DA,oBAAyBA,GACvB,IAAIC,EAAaC,EAAOC,SAASC,gBAC/B,gBACAC,MAAOC,IACL,MAAMC,EAAmBL,EAAOM,UAAUD,iBAC1C,IAAKA,EAEH,YADAE,EAAiB,WAInB,MAAMC,EAAkBJ,EACpBA,EAAIK,OACJT,EAAOU,OAAOC,kBAAkBC,SAASR,IAAIK,OAK3CI,EAnEZ,SAAgCC,GAC9B,IAAIC,EAAMD,EACV,KAAOC,IAAQ,UAAKC,MAAMD,GAAKE,MAAM,CACnC,MAAMJ,EAAkB,UAAKK,KAAKH,EAAK,gBACvC,GAAI,UAAGI,WAAWN,GAChB,OAAOA,EAETE,EAAM,UAAKK,QAAQL,EACrB,CACA,OAAO,IACT,CAyD8BM,CAJAb,EACpB,UAAKY,QAAQZ,GACbH,EAAiB,GAAGD,IAAIK,QAG5B,IAAKI,EAEH,YADAN,EAAiB,wBAInB,MAAMe,EAAcC,KAAKP,MAAM,UAAGQ,aAAaX,EAAiB,SAC1DY,EAAUH,EAAYG,QACtBC,EAAkBJ,EAAYK,KACpC,IAAKF,EAEH,YADAlB,EAAiB,yBAInB,MAAMqB,EAAaC,OAAOC,KAAKL,GACzBM,QAAuBC,EAAcJ,EAAY,CACrDK,YAAa,aAGVF,SAzEX5B,gBAA4B,WAC1B+B,EAAU,gBACVrB,EAAe,gBACfa,IAMA,MAAMS,EAAa,UAAKf,QAAQP,GAC1BuB,EAAeV,EAAkB,IAAMQ,EACvCG,EACW,YAAfH,EAA2B,QAAQA,IAAe,WAAWA,IAEzDI,EAAO,IAAItC,EAAOuC,KACtB,CAAEC,KAAM,SACRxC,EAAOyC,UAAUC,UACjBN,EACA,SACA,IAAIpC,EAAO2C,eAAeN,EAAY,GAAI,CACxCO,IAAKT,KAITG,EAAKO,oBAAsB,CAEzBC,OAAQ9C,EAAO+C,eAAeC,OAE9BC,OAAO,EACPC,MAAM,EACNC,OAAO,EACPC,MAAOpD,EAAOqD,cAAcC,WAG9BtD,EAAOuD,MAAMC,YAAYlB,EAC3B,CA0CYmB,CAAa,CACjBvB,WAAYH,EACZlB,kBACAa,mBACA,IAIN,MAAMgC,EAAU1D,EAAOuD,MAAMI,qBAAqBC,IAChD,MAAMC,EAAWD,EAAEE,UAAUxB,KAAKX,KAGjB,IAFAiC,EAAEG,WAGjBC,EAAuB,SAASH,YAChC7D,EAAOU,OAAOuD,UAAUC,SAASC,IAC3BA,EAASxC,OAASkC,GACpBM,EAASC,MACX,IAEJ,IAGFtE,EAAQuE,cAAcC,KAAKZ,GAE3B5D,EAAQuE,cAAcC,KAAKvE,EAC7B,EAEA,wBAA8B,EA7H9B,kBACA,YACA,aAEM,iBAAEQ,EAAgB,cAAEyB,EAAa,uBAAEgC,GACvChE,EAAOU,M,UCLT6D,EAAOC,QAAUC,QAAQ,S,UCAzBF,EAAOC,QAAUC,QAAQ,K,UCAzBF,EAAOC,QAAUC,QAAQ,O,GCCrBC,EAA2B,CAAC,ECE5BC,EDCJ,SAASC,EAAoBC,GAE5B,IAAIC,EAAeJ,EAAyBG,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAaN,QAGrB,IAAID,EAASG,EAAyBG,GAAY,CAGjDL,QAAS,CAAC,GAOX,OAHAQ,EAAoBH,GAAUI,KAAKV,EAAOC,QAASD,EAAQA,EAAOC,QAASI,GAGpEL,EAAOC,OACf,CCnB0BI,CAAoB,K","sources":["webpack://quickscript/./src/extension.ts","webpack://quickscript/external commonjs \"vscode\"","webpack://quickscript/external node-commonjs \"fs\"","webpack://quickscript/external node-commonjs \"path\"","webpack://quickscript/webpack/bootstrap","webpack://quickscript/webpack/startup"],"sourcesContent":["import * as vscode from \"vscode\";\r\nimport fs from \"fs\";\r\nimport path from \"path\";\r\n\r\nconst { showErrorMessage, showQuickPick, showInformationMessage } =\r\n  vscode.window;\r\n\r\n// 递归查找最近的 package.json\r\nfunction findNearestPackageJson(startPath: string) {\r\n  let dir = startPath;\r\n  while (dir !== path.parse(dir).root) {\r\n    const packageJsonPath = path.join(dir, \"package.json\");\r\n    if (fs.existsSync(packageJsonPath)) {\r\n      return packageJsonPath;\r\n    }\r\n    dir = path.dirname(dir);\r\n  }\r\n  return null;\r\n}\r\n\r\n// 执行 npm run 脚本\r\nasync function runNpmScript({\r\n  scriptName,\r\n  packageJsonPath,\r\n  packageJsonName,\r\n}: {\r\n  scriptName: string;\r\n  packageJsonPath: string;\r\n  packageJsonName: string;\r\n}) {\r\n  const projectDir = path.dirname(packageJsonPath);\r\n  const terminalName = packageJsonName + \"/\" + scriptName;\r\n  const scriptCode =\r\n    scriptName === \"codegen\" ? `yarn ${scriptName}` : `npm run ${scriptName}`;\r\n\r\n  const task = new vscode.Task(\r\n    { type: \"shell\" }, // 类型\r\n    vscode.TaskScope.Workspace, // 任务作用域\r\n    terminalName, // 任务名\r\n    \"custom\", // 自定义来源名\r\n    new vscode.ShellExecution(scriptCode, [], {\r\n      cwd: projectDir,\r\n    })\r\n  );\r\n\r\n  task.presentationOptions = {\r\n    // 只有出现错误时才自动打开终端\r\n    reveal: vscode.TaskRevealKind.Silent,\r\n    // 控制显示任务输出的面板是否获得焦点。\r\n    focus: true, // 将焦点切换到当前终端\r\n    echo: false, // 不显示命令输出\r\n    close: true, // 执行成功后自动关闭\r\n    panel: vscode.TaskPanelKind.Dedicated,\r\n  };\r\n\r\n  vscode.tasks.executeTask(task);\r\n}\r\n\r\nexport function activate(context: vscode.ExtensionContext) {\r\n  let disposable = vscode.commands.registerCommand(\r\n    \"quick-script\",\r\n    async (uri: vscode.Uri) => {\r\n      const workspaceFolders = vscode.workspace.workspaceFolders;\r\n      if (!workspaceFolders) {\r\n        showErrorMessage(\"没有找到工作区\");\r\n        return;\r\n      }\r\n\r\n      const currentFilePath = uri\r\n        ? uri.fsPath\r\n        : vscode.window.activeTextEditor?.document.uri.fsPath;\r\n      const searchStartPath = currentFilePath\r\n        ? path.dirname(currentFilePath)\r\n        : workspaceFolders[0].uri.fsPath;\r\n\r\n      const packageJsonPath = findNearestPackageJson(searchStartPath);\r\n      if (!packageJsonPath) {\r\n        showErrorMessage(\"在项目中找不到 package.json\");\r\n        return;\r\n      }\r\n\r\n      const packageJson = JSON.parse(fs.readFileSync(packageJsonPath, \"utf8\"));\r\n      const scripts = packageJson.scripts;\r\n      const packageJsonName = packageJson.name;\r\n      if (!scripts) {\r\n        showErrorMessage(\"在 package.json 中找不到脚本\");\r\n        return;\r\n      }\r\n\r\n      const scriptKeys = Object.keys(scripts);\r\n      const selectedScript = await showQuickPick(scriptKeys, {\r\n        placeHolder: \"选择一条指令执行\",\r\n      });\r\n\r\n      if (!selectedScript) {\r\n        return;\r\n      }\r\n\r\n      await runNpmScript({\r\n        scriptName: selectedScript,\r\n        packageJsonPath,\r\n        packageJsonName,\r\n      });\r\n    }\r\n  );\r\n\r\n  const taskEnd = vscode.tasks.onDidEndTaskProcess((e) => {\r\n    const taskName = e.execution.task.name;\r\n    const exitCode = e.exitCode;\r\n\r\n    if (exitCode === 0) {\r\n      showInformationMessage(`✅ 任务 \"${taskName}\" 已成功完成`);\r\n      vscode.window.terminals.forEach((terminal) => {\r\n        if (terminal.name !== taskName) {\r\n          terminal.hide();\r\n        }\r\n      });\r\n    }\r\n  });\r\n\r\n  context.subscriptions.push(taskEnd);\r\n\r\n  context.subscriptions.push(disposable);\r\n}\r\n\r\nexport function deactivate() {}\r\n","module.exports = require(\"vscode\");","module.exports = require(\"fs\");","module.exports = require(\"path\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(265);\n"],"names":["context","disposable","vscode","commands","registerCommand","async","uri","workspaceFolders","workspace","showErrorMessage","currentFilePath","fsPath","window","activeTextEditor","document","packageJsonPath","startPath","dir","parse","root","join","existsSync","dirname","findNearestPackageJson","packageJson","JSON","readFileSync","scripts","packageJsonName","name","scriptKeys","Object","keys","selectedScript","showQuickPick","placeHolder","scriptName","projectDir","terminalName","scriptCode","task","Task","type","TaskScope","Workspace","ShellExecution","cwd","presentationOptions","reveal","TaskRevealKind","Silent","focus","echo","close","panel","TaskPanelKind","Dedicated","tasks","executeTask","runNpmScript","taskEnd","onDidEndTaskProcess","e","taskName","execution","exitCode","showInformationMessage","terminals","forEach","terminal","hide","subscriptions","push","module","exports","require","__webpack_module_cache__","__webpack_exports__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","call"],"sourceRoot":""}